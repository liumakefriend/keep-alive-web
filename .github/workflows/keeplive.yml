on:
  # 计划任务触发
  schedule:
    # 每天北京时间 00:00 运行 (由于 GitHub 使用 UTC 时间，所以设定为 UTC 16:00)
    # - cron: '0 16 * * *'
    - cron: '0 */2 * * *'
  # 手动触发 (方便测试)
  workflow_dispatch:

jobs:
  visit-websites:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check out code (Optional)
        uses: actions/checkout@v3

      - name: Visit URLs 5 times
        run: |
          # 定义需要访问的网址数组
          URLS=(
            "https://huggingface.ber2y.de5.net/"
             "https://koyeb.ber2y.de5.net/"
             "https://koyeb.pitaya.de5.net/"
             "https://clawcloud.pitaya.de5.net/"
             # "https://ebihxdllplbi.ap-northeast-1.clawcloudrun.com/"
            # "https://itchy-janean-tomato1over-d7f4b8d7.koyeb.app/"
          )

          # 循环 5 次
          for ((i=1; i<=5; i++)); do
            echo "-----------------------------"
            echo "开始第 $i 次访问循环..."
            
            # 遍历每个 URL
            for url in "${URLS[@]}"; do
              echo "正在访问: $url"
              # 使用 curl 发送请求
              # -I: 只请求头部 (减少流量)
              # -s: 静默模式
              # -o /dev/null: 不输出内容
              # -w: 输出 HTTP 状态码
              # --user-agent: 伪装成浏览器，防止被拦截
              code=$(curl -s -o /dev/null -w "%{http_code}" --user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36" "$url")
              
              if [ "$code" == "200" ] || [ "$code" == "301" ] || [ "$code" == "302" ]; then
                echo "✅ 访问成功 (状态码: $code)"
              else
                echo "⚠️ 访问可能异常 (状态码: $code)"
              fi
            done
            
            # 每次循环后暂停 10 秒，避免请求过快被防火墙拦截
            echo "等待 600 秒..."
            sleep 600
          done
          echo "所有访问任务完成！"
